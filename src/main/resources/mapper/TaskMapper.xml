<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.mikezhu.mysqlparser.mapper.TaskMapper">

    <resultMap id="BaseResultMap" type="cn.mikezhu.mysqlparser.bo.Task">
        <id column="task_id" property="taskId" jdbcType="BIGINT"/>
        <result column="task_name" property="taskName" jdbcType="VARCHAR"/>
        <result column="last_start_time" property="lastStartTime" jdbcType="TIMESTAMP"/>
        <result column="last_end_time" property="lastEndTime" jdbcType="TIMESTAMP"/>
        <result column="last_host" property="lastHost" jdbcType="VARCHAR"/>
        <result column="next_scheduled_time" property="nextScheduledTime" jdbcType="TIMESTAMP"/>
        <result column="task_ex" property="taskEx" jdbcType="VARCHAR"/>
        <result column="execution_num" property="executionNum" jdbcType="INTEGER"/>
    </resultMap>

    <select id="selectTaskById" resultMap="BaseResultMap">
        SELECT * FROM dev_distributed_task.task
        <where>
            <if test="taskId != null">
            and    task_id = #{taskId}
            </if>
        </where>
    </select>

    <select id="selectAllTasks" resultMap="BaseResultMap">
        SELECT * FROM dev_distributed_task.task
    </select>

    <insert id="insertTask" parameterType="cn.mikezhu.mysqlparser.bo.Task" useGeneratedKeys="true" keyProperty="taskId">
        INSERT INTO dev_distributed_task.task(task_name, last_start_time, last_end_time, last_host, next_scheduled_time, task_ex, execution_num)
        VALUES(#{taskName}, #{lastStartTime}, #{lastEndTime}, #{lastHost}, #{nextScheduledTime}, #{taskEx}, #{executionNum})
    </insert>

    <update id="updateTask" parameterType="cn.mikezhu.mysqlparser.bo.Task">
        UPDATE dev_distributed_task.task
        <set>
            <if test="taskName != null">task_name = #{taskName},</if>
            <if test="lastStartTime != null">last_start_time = #{lastStartTime},</if>
            <if test="lastEndTime != null">last_end_time = #{lastEndTime},</if>
            <if test="lastHost != null">last_host = #{lastHost},</if>
            <if test="nextScheduledTime != null">next_scheduled_time = #{nextScheduledTime},</if>
            <if test="taskEx != null">task_ex = #{taskEx},</if>
            <if test="executionNum != null">execution_num = #{executionNum},</if>
        </set>
        WHERE task_id = #{taskId}
    </update>

    <delete id="deleteTask">
        DELETE FROM dev_distributed_task.task WHERE task_id = #{taskId}
    </delete>

</mapper>
